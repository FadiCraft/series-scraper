name: Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ

on:
  workflow_dispatch:
    inputs:
      video_url:
        description: 'ğŸ”— Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ'
        required: true

jobs:
  process:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯
      uses: actions/checkout@v4
      
    - name: âš¡ Cache FFmpeg
      id: cache-ffmpeg
      uses: actions/cache@v3
      with:
        path: ~/ffmpeg
        key: ${{ runner.os }}-ffmpeg-6.1
        
    - name: ğŸ“¦ ØªØ«Ø¨ÙŠØª FFmpeg
      if: steps.cache-ffmpeg.outputs.cache-hit != 'true'
      run: |
        mkdir -p ~/ffmpeg
        wget -q https://johnvansickle.com/ffmpeg/releases/ffmpeg-release-amd64-static.tar.xz
        tar -xf ffmpeg-release-amd64-static.tar.xz -C ~/ffmpeg --strip-components=1
        rm ffmpeg-release-amd64-static.tar.xz
        
    - name: ğŸ”§ Ø¥Ø¶Ø§ÙØ© FFmpeg Ø¥Ù„Ù‰ PATH
      run: echo "$HOME/ffmpeg" >> $GITHUB_PATH
          
    - name: ğŸ“¦ ØªØ«Ø¨ÙŠØª Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        
    - name: ğŸ“¥ ØªØ«Ø¨ÙŠØª Ø§Ù„Ø­Ø²Ù…
      run: |
        npm init -y
        npm install axios youtube-dl-exec fs path child_process
        
    - name: ğŸ“ ØªØ­Ø¶ÙŠØ± Ø§Ù„Ù…Ù„ÙØ§Øª
      run: mkdir -p output temp downloads
        
    - name: ğŸ“ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ù„ÙØ§Øª
      run: |
        echo "ğŸ“„ script.txt:"
        cat script.txt
        echo ""
        echo "ğŸµ Sund.mp3:"
        ls -la Sund.mp3
        
    - name: ğŸ¬ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬
      run: |
        time node processor.js "${{ github.event.inputs.video_url }}" script.txt Sund.mp3
        
    - name: ğŸ“¤ Ø±ÙØ¹ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
      uses: actions/upload-artifact@v4
      with:
        name: Ø§Ù„ÙÙŠØ¯ÙŠÙˆ-Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
        path: output/*.mp4
        retention-days: 7
