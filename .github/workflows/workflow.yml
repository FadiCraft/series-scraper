name: Video Processing Pipeline

on:
  push:
    branches: [ main ]
    paths:
      - 'input/**'
      - 'script.txt'
  workflow_dispatch:
    inputs:
      quality:
        description: 'Ø¬ÙˆØ¯Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ (high/medium/low)'
        required: true
        default: 'medium'

jobs:
  process:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        node-version: [18.x]
    
    steps:
    - uses: actions/checkout@v4  # ØªØ­Ø¯ÙŠØ« Ø¥Ù„Ù‰ v4 Ø£ÙŠØ¶Ø§Ù‹
    
    - name: Ø§Ø³ØªØ®Ø¯Ø§Ù… Node.js ${{ matrix.node-version }}
      uses: actions/setup-node@v4  # ØªØ­Ø¯ÙŠØ« Ø¥Ù„Ù‰ v4
      with:
        node-version: ${{ matrix.node-version }}
    
    - name: ØªØ«Ø¨ÙŠØª FFmpeg ÙˆØ§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ÙŠØ§Øª
      run: |
        sudo apt-get update
        sudo apt-get install -y ffmpeg
        npm ci
    
    - name: Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ù„ÙØ§Øª
      run: |
        if [ ! -f "input/video.mp4" ]; then
          echo "âŒ Ù…Ù„Ù Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯"
          exit 1
        fi
        if [ ! -f "input/sound.mp3" ]; then
          echo "âŒ Ù…Ù„Ù Ø§Ù„ØµÙˆØª ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯"
          exit 1
        fi
        if [ ! -f "script.txt" ]; then
          echo "âŒ Ù…Ù„Ù Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯"
          exit 1
        fi
        echo "âœ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ù…ÙˆØ¬ÙˆØ¯Ø©"
    
    - name: Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
      run: |
        mkdir -p temp_clips output
        node processor.js
      env:
        QUALITY: ${{ github.event.inputs.quality || 'medium' }}
    
    - name: Ø±ÙØ¹ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
      uses: actions/upload-artifact@v4  # âœ… ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¥Ù„Ù‰ v4
      with:
        name: processed-video-${{ github.run_number }}
        path: |
          output/final_summary.mp4
          script.txt
        if-no-files-found: error
        retention-days: 7  # Ù…ÙŠØ²Ø© Ø¬Ø¯ÙŠØ¯Ø© ÙÙŠ v4
    
    - name: Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø§Ù„Ù†Ø¬Ø§Ø­
      if: success()
      run: |
        echo "âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¨Ù†Ø¬Ø§Ø­!"
        echo "ğŸ“ ÙŠÙ…ÙƒÙ†Ùƒ ØªØ­Ù…ÙŠÙ„Ù‡ Ù…Ù† Artifacts"
    
    - name: Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø§Ù„ÙØ´Ù„
      if: failure()
      run: |
        echo "âŒ ÙØ´Ù„ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ"
        exit 1
