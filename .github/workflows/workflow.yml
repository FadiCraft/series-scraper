name: Video Processing Pipeline

on:
  push:
    branches: [ main ]
    paths:
      - 'input/**'
      - 'script.txt'
  workflow_dispatch:

jobs:
  process:
    runs-on: ubuntu-latest
    
    steps:
    - name: Ø§Ø³ØªÙ†Ø³Ø§Ø® Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹
      uses: actions/checkout@v4
    
    - name: Ø¥Ø¹Ø¯Ø§Ø¯ Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
    
    - name: ØªØ«Ø¨ÙŠØª FFmpeg
      run: |
        sudo apt-get update
        sudo apt-get install -y ffmpeg
        ffmpeg -version
    
    - name: ØªØ«Ø¨ÙŠØª Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ÙŠØ§Øª
      run: |
        npm init -y
        npm install fluent-ffmpeg
    
    - name: Ø¹Ø±Ø¶ Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª (Ù„Ù„ØªØ´Ø®ÙŠØµ)
      run: |
        echo "ğŸ“ Ù…Ø­ØªÙˆÙŠØ§Øª Ø§Ù„Ù…Ø¬Ù„Ø¯ Ø§Ù„Ø­Ø§Ù„ÙŠ:"
        ls -la
        echo "\nğŸ“ Ù…Ø­ØªÙˆÙŠØ§Øª Ù…Ø¬Ù„Ø¯ input:"
        ls -la input/ || echo "Ø§Ù„Ù…Ø¬Ù„Ø¯ input ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯"
    
    - name: ØªØ´ØºÙŠÙ„ Ø³ÙƒØ±Ø¨Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©
      run: node processor.js
      continue-on-error: false
    
    - name: Ø±ÙØ¹ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù†Ø§ØªØ¬
      if: success()
      uses: actions/upload-artifact@v4
      with:
        name: video-summary-${{ github.run_number }}
        path: output/final_summary.mp4
        retention-days: 7
        if-no-files-found: error
    
    - name: Ø±ÙØ¹ Ù…Ù„ÙØ§Øª Ø§Ù„ØªØ´Ø®ÙŠØµ (ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„ÙØ´Ù„)
      if: failure()
      uses: actions/upload-artifact@v4
      with:
        name: debug-files-${{ github.run_number }}
        path: |
          temp_clips/
          *.log
          script.txt
        retention-days: 3
