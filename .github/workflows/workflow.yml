name: ğŸ¬ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ø®Øµ Ø§Ù„ÙÙŠÙ„Ù… Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ

on:
  push:
    paths:
      - 'script.txt'
  workflow_dispatch:
    inputs:
      video_url:
        description: 'Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ (YouTube, Ù…Ø¨Ø§Ø´Ø±ØŒ Ø§Ù„Ø®)'
        required: true
        default: 'https://example.com/video.mp4'

jobs:
  create-summary:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Ø§Ø³ØªÙ†Ø³Ø§Ø® Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹
      uses: actions/checkout@v4
      
    - name: ğŸ”§ ØªØ«Ø¨ÙŠØª Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
      run: |
        sudo apt-get update
        sudo apt-get install -y ffmpeg espeak python3 python3-pip
        
    - name: ğŸ“¦ ØªØ«Ø¨ÙŠØª Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    - name: ğŸ“¦ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù package.json
      run: |
        cat > package.json << 'EOF'
        {
          "name": "molahas-movie-summary",
          "version": "1.0.0",
          "description": "Ù†Ø¸Ø§Ù… ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„ØµÙ†Ø§Ø¹Ø© ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª ØªÙ„Ø®ÙŠØµ Ø§Ù„Ø£ÙÙ„Ø§Ù…",
          "main": "Molahas.js",
          "dependencies": {
            "axios": "^1.6.0",
            "youtube-dl-exec": "^2.1.6",
            "ffmpeg-static": "^5.2.0",
            "ffprobe-static": "^3.1.0"
          }
        }
        EOF
        
    - name: ğŸ“¦ ØªØ«Ø¨ÙŠØª Ø§Ù„Ø­Ø²Ù…
      run: |
        npm install
        # ØªØ£ÙƒØ¯ Ù…Ù† ØªØ«Ø¨ÙŠØª Ø§Ù„Ø­Ø²Ù…
        npm list
        
    - name: ğŸ“ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ù„Ù Ø§Ù„Ù†Øµ
      run: |
        if [ ! -f "script.txt" ]; then
          echo "âŒ Ù…Ù„Ù script.txt ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯!"
          echo "ğŸ“ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù ØªØ¬Ø±ÙŠØ¨ÙŠ..."
          cat > script.txt << 'EOF'
        00:00-00:30 | Ù…Ø´Ù‡Ø¯ ØªØ¬Ø±ÙŠØ¨ÙŠ Ø£ÙˆÙ„
        00:30-01:00 | Ù…Ø´Ù‡Ø¯ ØªØ¬Ø±ÙŠØ¨ÙŠ Ø«Ø§Ù†ÙŠ
        EOF
        fi
        
    - name: ğŸŒ ØªØ­Ø¯ÙŠØ¯ Ù…ØµØ¯Ø± Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
      id: video-source
      run: |
        if [[ -f "movie.mp4" ]]; then
          echo "source=movie.mp4" >> $GITHUB_OUTPUT
          echo "ğŸ“ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù…Ø­Ù„ÙŠ: movie.mp4"
        else
          echo "source=${{ github.event.inputs.video_url }}" >> $GITHUB_OUTPUT
          echo "ğŸŒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø±Ø§Ø¨Ø·: ${{ github.event.inputs.video_url }}"
        fi
    
    - name: ğŸ¬ ØªØ´ØºÙŠÙ„ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ù„Ø®Øµ
      run: |
        echo "ğŸš€ Ø¨Ø¯Ø¡ ØªØ´ØºÙŠÙ„ processor.js"
        node processor.js "${{ steps.video-source.outputs.source }}" script.txt
      
    - name: ğŸ“¤ Ø±ÙØ¹ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
      uses: actions/upload-artifact@v4
      with:
        name: movie-summary
        path: output/*.mp4
        if-no-files-found: warn
        
    - name: ğŸ“¦ Ø¥Ù†Ø´Ø§Ø¡ Ø¥ØµØ¯Ø§Ø± Ø¬Ø¯ÙŠØ¯
      if: success()
      uses: softprops/action-gh-release@v2
      with:
        files: output/*.mp4
        name: "Ù…Ù„Ø®Øµ Ø§Ù„ÙÙŠÙ„Ù… - ${{ github.run_number }}"
        tag_name: v${{ github.run_number }}
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
